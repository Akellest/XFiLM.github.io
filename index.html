<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combined Tables</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .editable {
            background-color: #f0e68c; /* Цвет для выделения редактируемых ячеек */
        }
        /* Стиль для кнопок */
        .button-container {
            position: fixed; /* Зафиксированное положение */
            top: 10px; /* Отступ сверху */
            right: 10px; /* Отступ справа */
            z-index: 1000; /* Слой над другими элементами */
        }
        .button-container button {
            margin: 5px; /* Отступы между кнопками */
            padding: 10px 15px; /* Размеры кнопок */
            cursor: pointer; /* Курсор при наведении */
        }
    </style>
</head>
<body>
    <div id="prescriptum"></div>
    <div id="combinedTables"></div>
    <div id="tooltip" class="tooltip"></div>
    
    <!-- Контейнер для кнопок -->
    <div class="button-container">
        <button id="editBtn">Редактировать</button>
        <button id="saveBtn" style="display: none;">Сохранить изменения</button>
        <button id="cancelBtn" style="display: none;">Отменить изменения</button>
    </div>

    <script>
        const seriesClasses = ['harry-potter', 'potc', 'avengers', 'krok-gena', 'bourne', 'x-men', 'batman-nolan', 'miniputs', 'bagr-reki', 'spy-kids', 'iron-man', 'carlson-ussr', 'transformers', 'fast-furious', 'sherlock-ussr', 'shrek', 'parkour13', 'adrenalin', 'astral', 'brat', 'casa-papel', 'hunger-games', 'tattoo-girl', 'john-wick', 'divergent', 'big-mamma-house', 'star-wars', 'fockers', 'ip-man', 'james-bond', 'jump-street', 'mission-impossible', 'scary-movie', 'wolferine', 'silent-hill', 'split', 'twin-peaks', 'terminator', 'topgun', 'ouija', 'monsters-disney', 'narnia-chronicles', 'alien', 'sherlock-robert', 'conjuring', 'taken-girl'];

        // Функция для загрузки таблицы из файла
        async function loadFile(filename, elementId) {
            try {
                const response = await fetch(`html/${filename}`);
                if (!response.ok) {
                    throw new Error(`Ошибка загрузки: ${response.statusText}`);
                }
                const data = await response.text();
                document.getElementById(elementId).innerHTML = data;
            } catch (error) {
                console.error('Ошибка:', error);
            }
        }

        // Загрузка файла prescriptum.html в div с id="prescriptum"
        loadFile('prescriptum.html', 'prescriptum');

        async function loadTable(filename) {
            try {
                const response = await fetch(`html/${filename}`);
                if (!response.ok) {
                    throw new Error(`Ошибка загрузки: ${response.statusText}`);
                }
                const data = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');
                const tableElement = doc.querySelector('table');

                if (!tableElement) {
                    console.error(`Таблица не найдена в файле: ${filename}`);
                    return '';
                }

                // Получаем название файла без расширения
                const className = filename.split('/').pop().split('.')[0];

                // Добавляем классы к таблице
                tableElement.classList.add(className);
                if (className !== 'table-header') {
                    tableElement.classList.add('table');
                }

                return tableElement.outerHTML;
            } catch (error) {
                console.error('Ошибка загрузки таблицы:', error);
                return '';
            }
        }

        // Основная функция для объединения таблиц
        async function combineTables() {
            const tableFiles = ['table-header.html', 'quote0.html', 'table1.html', 'quote1.html', 'table2.html', 'quote2.html', 'table3.html', 'quote3.html', 'table4.html'];
            const tablePromises = tableFiles.map(loadTable);

            const tables = await Promise.all(tablePromises);
            const combinedContent = tables.join(''); // Объединяем таблицы без отступов
            document.getElementById('combinedTables').innerHTML = combinedContent; // Вставляем в нужный элемент

            document.querySelectorAll('.third-column').forEach(cell => {
                if (/[а-яА-ЯЁё]/.test(cell.textContent)) {
                    cell.classList.add('russian');
                } else {
                    cell.classList.add('english');
                }
            });

            addHoverEffect();
        }

        function addHoverEffect() {
            const tooltip = document.getElementById('tooltip');

            seriesClasses.forEach(seriesClass => {
                const movies = document.querySelectorAll(`.${seriesClass}`);

                movies.forEach(movie => {
                    movie.addEventListener('mousemove', (event) => {
                        const movieInfo = Array.from(document.querySelectorAll(`.${seriesClass}`)).map(el => {
                            const yearCell = el.closest('tr').querySelector('td.fourth-column:nth-of-type(4)');
                            return { title: el.textContent, year: yearCell ? yearCell.textContent : 'Unknown' };
                        });

                        movieInfo.sort((a, b) => a.year - b.year);
                        tooltip.innerHTML = movieInfo.map(info => info.title).join('<br>');

                        tooltip.style.display = 'block';
                        tooltip.style.left = `${event.pageX + 10}px`;
                        tooltip.style.top = `${event.pageY + 10}px`;
                    });

                    movie.addEventListener('mouseout', () => {
                        tooltip.style.display = 'none';
                    });
                });
            });
        }

        // Режим редактирования
        let editing = false;

        document.getElementById('editBtn').addEventListener('click', () => {
            editing = !editing;
            document.querySelectorAll('td').forEach(cell => {
                cell.contentEditable = editing; // Устанавливаем ячейкам свойство contentEditable
                if (editing) {
                    cell.classList.add('editable'); // Добавляем класс для выделения редактируемых ячеек
                } else {
                    cell.classList.remove('editable'); // Убираем класс
                }
            });
            document.getElementById('saveBtn').style.display = editing ? 'inline' : 'none'; // Показать кнопку сохранения
            document.getElementById('cancelBtn').style.display = editing ? 'inline' : 'none'; // Показать кнопку отмены
        });

        document.getElementById('saveBtn').addEventListener('click', () => {
            if (!editing) return;

            // Окно подтверждения перед сохранением
            const confirmSave = confirm("Принять изменения?");
            if (confirmSave) {
                alert("Изменения приняты!");
                // Здесь можно добавить логику для сохранения изменений на сервере, если необходимо
            } else {
                cancelEditing(); // Если изменения не приняты, вызываем функцию отмены
            }
        });

        document.getElementById('cancelBtn').addEventListener('click', () => {
            cancelEditing(); // Вызываем функцию отмены при нажатии на кнопку отмены
        });

        function cancelEditing() {
            document.querySelectorAll('td').forEach(cell => {
                cell.contentEditable = false; // Отключаем редактирование
                cell.classList.remove('editable'); // Убираем класс
            });
            editing = false;
            document.getElementById('saveBtn').style.display = 'none'; // Скрыть кнопку сохранения
            document.getElementById('cancelBtn').style.display = 'none'; // Скрыть кнопку отмены
        }

        combineTables().then(() => {
            const links = document.querySelectorAll('a');
            links.forEach(link => {
                link.setAttribute('target', '_blank');
                link.setAttribute('rel', 'noopener noreferrer');
            });
        });
    </script>

    <div id="combinedTables"></div>

</body>
</html>
